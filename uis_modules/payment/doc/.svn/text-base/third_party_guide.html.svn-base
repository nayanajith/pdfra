<LINK href="style.css" rel="stylesheet" type="text/css">
<h1>Universal payment gateway for UCSC</h1>
<h2>Registration with payment gateway</h2>
<ol>
<li>Registration of a program</li>
When a third-party registering for a payment program, following information should be provided.
<ol>
<li>Third-party host name or the IP</li>
<li>Callback-url (eg: payment/gateway_callback.php) </li>
<li>The mail of the third-party payment coordinator</li>
<li>Telephone number of the coordinator</li>
<li>Description about the program</li>
<li>Optionally a logo can be provided</li>
<li>Program code (eg: BIT) should be discuss with the payment gateway admin.</li>
<li>Third-party payment coordinator's name</li>
</ol>
<li>Registration of a payment type</li>
After registering a payment program, payment type can be registered. For that, the third-party payment coordinator should provide following information to the payment gateway admin.
<ol>
<li>Description of the payment type (eg: Registration)</li>
<li>Amount for this type - 0 if amount is variable or a fixed amount (eg: 750.00) can be provided.</li>
<li>Tax amount for this specific type should be discuss with the payment gateway admin</li>
<li>Payment type code should be discuss with the payment gateway admin</li>
<li>Third-party payment coordinator name should be provided if it is differ from the program coordinator provided above.</li>
</ol>
</ol>
<h2>Implementing the third-party module to communicate with the payment gateway</h2>
<h3>URL request from third party to the payment gateway</h3>
The third-party should send following validated parameters to the payment gateway. The parameters 1 to 3 should be fixed and it is used by the payment gateway to understand the correct functionality for the third-party requesting. Each parameter is in lower case letters. 
<ol>
<li>module=payment</li>
<li>page=tp_payment</li>
<li>data=true</li>
<li>tp_ref_id</li>
Third-party reference Id which refer to the specific payment which will be used identify the callbacks from the gateway
<li>program</li>
Program code (eg: BIT) which should be negotiated with the payment gateway admin when registering the program. The code may contain not less than or equal five characters.
<li>pay_for</li>
Payment type code (eg: REG) which will be provided when registering a payment type
<li>amount</li>
The total amount of Rupees which the payer will attend to pay (float)  
<li>nic</li>
The National Identity Card number of the payer (10 digits)
<li>email</li>
Email address of the payer should be provided. Which will be used to send the invoice/receipt to the payer
<li>full_name</li>
Full name of the payer with each part separated by spaces (eg: damith asanka dasanayake) 
</ol>

<h4>Resulting URL will look like this (in a GET request)</h4>
<p>Note: using a HTTP POST requests are recommended</p>
<code>
https://<paymeng_gateway_host>/<path>/?module=payment&page=tp_payment&data=true&tp_ref_id=R2006&program=BIT&pay_for=REG&amount=750.00&nic=852950201v&email=damith@gmail.com&full_name=damith asanka dasanayake
</code>
<h4>Error codes</h4>
	In any error, the payment will no be proceed and an error code will be returned to the third-party application. Error codes are starting from -100.
<ol>
<li>-100 : There are errors in parameters sent by the third-party</li>
<li>-101 : Program not valid</li>
<li>-102 : Payment type not valid</li>
</ol>
<h3>URL callback from payment gateway to third party</h3>
When the payment gateway callback the third-party callback-url it will contain the following information.

<ol>
<li>tp_ref_id</li>
The third-party reference Id which was sent earlier with the third-party request. This will be used to map the information with the relevant payment.
<li>tr_ref_id</li>
	Transaction reference Id is sent to the third-party to keep with the specific payment record to 	keep the mapping between the records in payment gateway. This tr_ref_id will be sent to the 	payer with the invoice for further queries to be done by the payer. 
<li>State</li>
The state of the payment will be on of the following
<ul>
<li>REJECTED
<li>ACCEPTED 
</ul>
With the state parameter third-party will be informed wether the payment is completed successfully. If the state is ACCEPTED the payment is completed successfully and the payment record can be modified accordingly. If state is either REJECTED third-party should display a message to the payer informing the situation. 
<li>Tax</li>
There will be a convenience fee for each payment for using online payment system. It will be mostly 3.34% from the total amount and the calculated total convenience fee will be provided with this parameter. 
</ol>

<h4>Resulting URL will look like this (for GET request)</h4>
<p>Note: using a HTTP POST requests are recommended</p>
<code>
http://<thirdparty_host>/<path>/?tp_ref_id=200&tr_re_id=BIT-REG-00061343&state=ACCEPTED&tax=3.34
</code>
<p>
Each request from third-party to the payment gateway and the callback from payment gateway to the third-party application should be done through a SSL connection to make the communicate secure.
</p>
